# ================================================
# ğŸ¤– RANOnline AI Backend Engine
# AIåç«¯æ¨ç†å¼•æ“ - å¤šçº¿ç¨‹ + è´Ÿè½½å‡è¡¡
# ================================================

# AIå¼•æ“åº“
add_library(ai_backend_engine_lib STATIC
    AIEngine.cpp
    AIEngine.h
    AIPlayerInstance.cpp
)

# AIå¼•æ“å¯æ‰§è¡Œç¨‹åº
add_executable(ai_backend_engine
    main.cpp
)

# åº“ä¾èµ–é“¾æ¥
target_link_libraries(ai_backend_engine_lib
    Qt6::Core
    Qt6::Concurrent
    communication_protocol
    database_sync_module
    Threads::Threads
)

# å¯æ‰§è¡Œç¨‹åºä¾èµ–é“¾æ¥
target_link_libraries(ai_backend_engine
    ai_backend_engine_lib
    Qt6::Core
    Qt6::Concurrent
    communication_protocol
    database_sync_module
    Threads::Threads
)

# Windowsç‰¹å®šè®¾ç½®
if(WIN32)
    target_compile_definitions(ai_backend_engine_lib PRIVATE
        WIN32_LEAN_AND_MEAN
        NOMINMAX
    )
    target_compile_definitions(ai_backend_engine PRIVATE
        WIN32_LEAN_AND_MEAN
        NOMINMAX
    )
    
    # è®¾ç½®æ§åˆ¶å°ç¨‹åº
    set_target_properties(ai_backend_engine PROPERTIES
        WIN32_EXECUTABLE FALSE
    )
endif()

# åŒ…å«ç›®å½•
target_include_directories(ai_backend_engine_lib PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}
)

target_include_directories(ai_backend_engine PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
)

# ç¼–è¯‘å™¨ç‰¹æ€§
target_compile_features(ai_backend_engine_lib PRIVATE cxx_std_20)
target_compile_features(ai_backend_engine PRIVATE cxx_std_20)

# é¢„ç¼–è¯‘å¤´ï¼ˆä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦ï¼‰
if(MSVC)
    target_precompile_headers(ai_backend_engine_lib PRIVATE
        <QtCore/QObject>
        <QtCore/QThread>
        <QtCore/QTimer>
        <memory>
        <thread>
        <mutex>
        <atomic>
        <vector>
        <queue>
    )
endif()

# Releaseæ¨¡å¼ä¼˜åŒ–
if(CMAKE_BUILD_TYPE STREQUAL "Release")
    if(MSVC)
        target_compile_options(ai_backend_engine_lib PRIVATE /O2 /Ob2)
        target_compile_options(ai_backend_engine PRIVATE /O2 /Ob2)
    endif()
endif()

# å®‰è£…è®¾ç½®
install(TARGETS ai_backend_engine ai_backend_engine_lib
    RUNTIME DESTINATION bin
    ARCHIVE DESTINATION lib
    LIBRARY DESTINATION lib
)

install(FILES AIEngine.h
    DESTINATION include/ai_backend_engine
)

# è°ƒè¯•ä¿¡æ¯
message(STATUS "âœ… AI Backend Engine configured")
