# ================================================
# ğŸ—„ï¸ RANOnline Database Sync Module
# æ•°æ®åº“åŒæ­¥æ¨¡å— - SQL Server 2022 + ODBC/ADO
# ================================================

# æ•°æ®åº“åŒæ­¥åº“
add_library(database_sync_module STATIC
    DatabaseManager.cpp
    DatabaseManager.h
)

# é“¾æ¥ä¾èµ–
target_link_libraries(database_sync_module 
    Qt6::Core
    Qt6::Sql
    Qt6::Concurrent
    communication_protocol
    Threads::Threads
)

# Windowsç‰¹å®šä¾èµ–
if(WIN32)
    target_link_libraries(database_sync_module
        ${ODBC_LIBRARY}
        ole32
        oleaut32
    )
    target_compile_definitions(database_sync_module PRIVATE
        WIN32_LEAN_AND_MEAN
        NOMINMAX
        _WIN32_DCOM
    )
endif()

# åŒ…å«ç›®å½•
target_include_directories(database_sync_module PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}
)

# ç¼–è¯‘å™¨ç‰¹å®šè®¾ç½®
target_compile_features(database_sync_module PRIVATE cxx_std_20)

# é¢„ç¼–è¯‘å¤´ï¼ˆä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦ï¼‰
if(MSVC)
    target_precompile_headers(database_sync_module PRIVATE
        <QtCore/QObject>
        <QtSql/QSqlDatabase>
        <QtSql/QSqlQuery>
        <memory>
        <thread>
        <mutex>
    )
endif()

# å®‰è£…è®¾ç½®
install(TARGETS database_sync_module
    ARCHIVE DESTINATION lib
    LIBRARY DESTINATION lib
)

install(FILES DatabaseManager.h
    DESTINATION include/database_sync_module
)

# è°ƒè¯•ä¿¡æ¯
message(STATUS "âœ… Database Sync Module configured")
