# RANOnline EP7 AI Simulation System - C++ Ultimate Edition
# ç»ˆæ C++ + Qt6 ç§‘æŠ€æ„Ÿ AIåº”ç”¨ç¨‹åºä¸»æ„å»ºé…ç½®
# å¼€å‘å›¢é˜Ÿ: JyæŠ€æœ¯å›¢é˜Ÿ
# åˆ›å»ºæ—¥æœŸ: 2025å¹´6æœˆ14æ—¥

cmake_minimum_required(VERSION 3.20)
project(RANOnline_CPP_Ultimate 
    VERSION 2.0.0 
    DESCRIPTION "RANOnline EP7 AI Simulation System - C++ Ultimate Edition"
    LANGUAGES CXX
)

# ================================================
# ğŸ”§ ç¼–è¯‘å™¨å’Œæ ‡å‡†è®¾ç½®
# ================================================
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Windowsç‰¹å®šè®¾ç½®
if(WIN32)
    # å¯ç”¨å¤šæ ¸ç¼–è¯‘
    add_compile_options("/MP")
    # é™æ€è¿è¡Œæ—¶åº“ï¼ˆå¯é€‰ï¼‰
    set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
    # Unicodeæ”¯æŒ
    add_definitions(-DUNICODE -D_UNICODE)
endif()

# ================================================
# ğŸ¯ æ„å»ºç±»å‹é…ç½®
# ================================================
if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Release)
endif()

# Debugé…ç½®
set(CMAKE_CXX_FLAGS_DEBUG "-g -O0 -DDEBUG")
# Releaseé…ç½®
set(CMAKE_CXX_FLAGS_RELEASE "-O3 -DNDEBUG")

# ================================================
# ğŸ“¦ ä¾èµ–åŒ…æŸ¥æ‰¾
# ================================================

# Qt6æŸ¥æ‰¾å’Œé…ç½®
find_package(Qt6 REQUIRED COMPONENTS 
    Core 
    Widgets 
    Network 
    Sql 
    Concurrent
)

# è®¾ç½®Qt6è‡ªåŠ¨åŒ–å·¥å…·
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# ProtobufæŸ¥æ‰¾ï¼ˆå¯é€‰ï¼‰
find_package(Protobuf QUIET)
if(Protobuf_FOUND)
    message(STATUS "âœ… Protobuf found: ${Protobuf_VERSION}")
    set(HAVE_PROTOBUF TRUE)
else()
    message(STATUS "âš ï¸ Protobuf not found, some features may be disabled")
    set(HAVE_PROTOBUF FALSE)
endif()

# çº¿ç¨‹åº“
find_package(Threads REQUIRED)

# ODBCåº“ï¼ˆWindowsï¼Œå¯é€‰ï¼‰
if(WIN32)
    find_library(ODBC_LIBRARY odbc32)
    if(ODBC_LIBRARY)
        message(STATUS "âœ… ODBC library found: ${ODBC_LIBRARY}")
        set(HAVE_ODBC TRUE)
    else()
        message(STATUS "âš ï¸ ODBC library not found, database features may be limited")
        set(HAVE_ODBC FALSE)
    endif()
else()
    set(HAVE_ODBC FALSE)
endif()

# ================================================
# ğŸ”— å…¨å±€åŒ…å«ç›®å½•
# ================================================
include_directories(
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/Communication_Protocol
    ${CMAKE_CURRENT_SOURCE_DIR}/Database_Sync_Module
    ${CMAKE_CURRENT_SOURCE_DIR}/AI_LLM_Integration
)

# æ·»åŠ ProtobufåŒ…å«ç›®å½•ï¼ˆå¦‚æœæ‰¾åˆ°ï¼‰
if(HAVE_PROTOBUF)
    include_directories(${Protobuf_INCLUDE_DIRS})
endif()

# ================================================
# ğŸ“ å­é¡¹ç›®ç›®å½•
# ================================================

# é€šä¿¡åè®®æ¨¡å—ï¼ˆæœ€å…ˆæ„å»ºï¼‰
add_subdirectory(Communication_Protocol)

# æ•°æ®åº“åŒæ­¥æ¨¡å—
add_subdirectory(Database_Sync_Module)

# AI LLMé›†æˆæ¨¡å—
add_subdirectory(AI_LLM_Integration)

# AIåç«¯æ¨ç†å¼•æ“
add_subdirectory(AI_Backend_Engine)

# AIå‰ç«¯ç®¡ç†ç•Œé¢
add_subdirectory(AI_Frontend_Manager)

# ================================================
# ğŸ§ª æµ‹è¯•é…ç½®ï¼ˆå¯é€‰ï¼‰
# ================================================
option(BUILD_TESTS "Build tests" OFF)
if(BUILD_TESTS)
    enable_testing()
    add_subdirectory(Tests)
endif()

# ================================================
# ğŸ“‹ å®‰è£…é…ç½®
# ================================================
install(TARGETS 
    ai_frontend_manager 
    ai_backend_engine
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
)

# å®‰è£…é…ç½®æ–‡ä»¶
install(DIRECTORY Config/ DESTINATION config)

# å®‰è£…èµ„æºæ–‡ä»¶
install(DIRECTORY Resources/ DESTINATION resources)

# ================================================
# ğŸ“¦ æ‰“åŒ…é…ç½®
# ================================================
set(CPACK_PACKAGE_NAME "RANOnline_CPP_Ultimate")
set(CPACK_PACKAGE_VERSION "${PROJECT_VERSION}")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "RANOnline EP7 AI Simulation System - C++ Ultimate Edition")
set(CPACK_PACKAGE_VENDOR "JyæŠ€æœ¯å›¢é˜Ÿ")
set(CPACK_PACKAGE_CONTACT "support@jytech.team")

if(WIN32)
    set(CPACK_GENERATOR "ZIP;NSIS")
    set(CPACK_NSIS_DISPLAY_NAME "RANOnline AI System Ultimate")
    set(CPACK_NSIS_PACKAGE_NAME "RANOnline AI System Ultimate")
    set(CPACK_NSIS_CONTACT "support@jytech.team")
    set(CPACK_NSIS_HELP_LINK "https://jytech.team/ranonline")
endif()

include(CPack)

# ================================================
# ğŸ“Š æ„å»ºä¿¡æ¯è¾“å‡º
# ================================================
message(STATUS "")
message(STATUS "ğŸš€ RANOnline EP7 AI Simulation System - C++ Ultimate Edition")
message(STATUS "================================================")
message(STATUS "ğŸ“‹ é¡¹ç›®ç‰ˆæœ¬: ${PROJECT_VERSION}")
message(STATUS "ğŸ”§ æ„å»ºç±»å‹: ${CMAKE_BUILD_TYPE}")
message(STATUS "ğŸ’» ç¼–è¯‘å™¨: ${CMAKE_CXX_COMPILER_ID} ${CMAKE_CXX_COMPILER_VERSION}")
message(STATUS "ğŸ¯ C++æ ‡å‡†: ${CMAKE_CXX_STANDARD}")
message(STATUS "ğŸ“¦ Qtç‰ˆæœ¬: ${Qt6_VERSION}")
message(STATUS "ğŸ”— Protobufç‰ˆæœ¬: ${Protobuf_VERSION}")
message(STATUS "================================================")
message(STATUS "")
